var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf3=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _propTypes=require("prop-types");var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _common=require("../../common");var _Ripple=_interopRequireDefault(require("./components/Ripple"));var _Touchable=_interopRequireDefault(require("./Touchable.style"));var _jsxFileName="/Users/soyjavi/git/minube/reactor/components/Touchable/Touchable.js";var COLOR=_common.THEME.COLOR;var IS_NATIVE=_common.ENV.IS_NATIVE;var ANIMATION={toValue:1,easing:_reactNative.Easing.out(_reactNative.Easing.ease),duration:400,useNativeDriver:IS_NATIVE};var Touchable=function(_PureComponent){(0,_inherits2.default)(Touchable,_PureComponent);function Touchable(){var _getPrototypeOf2;var _this;(0,_classCallCheck2.default)(this,Touchable);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=(0,_possibleConstructorReturn2.default)(this,(_getPrototypeOf2=(0,_getPrototypeOf3.default)(Touchable)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.mounted=false;_this.state={width:0,height:0,ripples:[],mask:new _reactNative.Animated.Value(0)};_this.onAnimationEnd=function(){if(_this.mounted){_this.setState(function(_ref){var ripples=_ref.ripples;return{ripples:ripples.slice(1)};});}};_this._onLayout=function(event){var _event$nativeEvent$la=event.nativeEvent.layout,width=_event$nativeEvent$la.width,height=_event$nativeEvent$la.height;_this.setState({width:width,height:height});};_this._onPressIn=function(event){var _assertThisInitialize=(0,_assertThisInitialized2.default)(_this),onAnimationEnd=_assertThisInitialize.onAnimationEnd,_assertThisInitialize2=_assertThisInitialize.state,mask=_assertThisInitialize2.mask,ripples=_assertThisInitialize2.ripples,width=_assertThisInitialize2.width,height=_assertThisInitialize2.height;var _event$nativeEvent=event.nativeEvent,x=_event$nativeEvent.locationX,y=_event$nativeEvent.locationY;var w=0.5*width;var h=0.5*height;var offsetX=Math.abs(w-x);var offsetY=Math.abs(h-y);var ripple={key:new Date().getTime(),progress:new _reactNative.Animated.Value(0),range:Math.sqrt(Math.pow(w+offsetX,2)+Math.pow(h+offsetY,2)),x:x,y:y};_reactNative.Animated.timing(mask,(0,_objectSpread2.default)({},ANIMATION,{delay:ANIMATION.duration/4,toValue:0.25})).start();_reactNative.Animated.timing(ripple.progress,ANIMATION).start(onAnimationEnd);_this.setState({ripples:[].concat((0,_toConsumableArray2.default)(ripples),[ripple])});};_this._onPressOut=function(){var _assertThisInitialize3=(0,_assertThisInitialized2.default)(_this),mask=_assertThisInitialize3.state.mask;_reactNative.Animated.timing(mask,(0,_objectSpread2.default)({},ANIMATION,{toValue:0})).start();};_this._onPress=function(event){var _assertThisInitialize4=(0,_assertThisInitialized2.default)(_this),onPress=_assertThisInitialize4.props.onPress;event.preventDefault();onPress(event);};return _this;}(0,_createClass2.default)(Touchable,[{key:"componentDidMount",value:function componentDidMount(){this.mounted=true;}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.mounted=false;}},{key:"render",value:function render(){var _onPress=this._onPress,_onPressIn=this._onPressIn,_onPressOut=this._onPressOut,_onLayout=this._onLayout,_this$props=this.props,children=_this$props.children,containerBorderRadius=_this$props.containerBorderRadius,onPress=_this$props.onPress,rippleColor=_this$props.rippleColor,inherit=(0,_objectWithoutProperties2.default)(_this$props,["children","containerBorderRadius","onPress","rippleColor"]),_this$state=this.state,mask=_this$state.mask,width=_this$state.width,height=_this$state.height,_this$state$ripples=_this$state.ripples,ripples=_this$state$ripples===void 0?[]:_this$state$ripples;var events={};if(onPress){events={onLayout:_onLayout,onPressIn:_onPressIn,onPressOut:_onPressOut,onPress:_onPress};}return _react.default.createElement(_reactNative.TouchableWithoutFeedback,(0,_extends2.default)({},events,{__source:{fileName:_jsxFileName,lineNumber:126}}),_react.default.createElement(_reactNative.View,{style:inherit.style,pointerEvents:onPress?'box-only':undefined,__source:{fileName:_jsxFileName,lineNumber:127}},children,_react.default.createElement(_reactNative.View,{style:[_Touchable.default.container,containerBorderRadius&&{borderRadius:containerBorderRadius}],__source:{fileName:_jsxFileName,lineNumber:129}},ripples.map(function(props){return _react.default.createElement(_Ripple.default,(0,_extends2.default)({color:rippleColor},props,{__source:{fileName:_jsxFileName,lineNumber:130}}));}),_react.default.createElement(_reactNative.Animated.View,{style:[_Touchable.default.mask,{opacity:mask,height:height,width:width},rippleColor&&{backgroundColor:rippleColor}],__source:{fileName:_jsxFileName,lineNumber:131}}))));}}]);return Touchable;}(_react.PureComponent);Touchable.propTypes={children:_propTypes.node,containerBorderRadius:_propTypes.number,onPress:_propTypes.func,rippleColor:_propTypes.string};Touchable.defaultProps={children:undefined,containerBorderRadius:undefined,onPress:undefined,rippleColor:COLOR.BASE};var _default=Touchable;exports.default=_default;