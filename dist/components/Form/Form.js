var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf3=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _propTypes=require("prop-types");var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _Input=_interopRequireDefault(require("../Input"));var _InputImage=_interopRequireDefault(require("../InputImage"));var _InputList=_interopRequireDefault(require("../InputList"));var _InputOption=_interopRequireDefault(require("../InputOption"));var _InputSelect=_interopRequireDefault(require("../InputSelect"));var _Text=_interopRequireDefault(require("../Text"));var _Switch=_interopRequireDefault(require("../Switch"));var _modules=require("./modules");var _Form=_interopRequireDefault(require("./Form.style"));var _jsxFileName="/Users/soyjavi/git/minube/reactor/components/Form/Form.js";var KEYBOARDS={'email-address':_modules.isValidEmail,'phone-pad':_modules.isValidPhone};var Inputs={bool:_Switch.default,image:_InputImage.default,option:_InputOption.default,select:_InputSelect.default,list:_InputList.default};var Form=function(_PureComponent){(0,_inherits2.default)(Form,_PureComponent);function Form(){var _getPrototypeOf2;var _this;(0,_classCallCheck2.default)(this,Form);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=(0,_possibleConstructorReturn2.default)(this,(_getPrototypeOf2=(0,_getPrototypeOf3.default)(Form)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={valid:true};_this._onChange=function(_ref){var keyValue=_ref.keyValue,keyMap=_ref.keyMap;var _assertThisInitialize=(0,_assertThisInitialized2.default)(_this),_assertThisInitialize2=_assertThisInitialize.props,value=_assertThisInitialize2.value,onChange=_assertThisInitialize2.onChange;if(onChange)onChange((0,_modules.set)(value,keyMap,keyValue));};_this.renderForm=function(_ref2){var _ref2$attributes=_ref2.attributes,attributes=_ref2$attributes===void 0?{}:_ref2$attributes,_ref2$fieldset=_ref2.fieldset,fieldset=_ref2$fieldset===void 0?false:_ref2$fieldset,inline=_ref2.inline,key=_ref2.key,style=_ref2.style,title=_ref2.title,_ref2$value=_ref2.value,value=_ref2$value===void 0?{}:_ref2$value;var _assertThisInitialize3=(0,_assertThisInitialized2.default)(_this),renderField=_assertThisInitialize3.renderField,renderForm=_assertThisInitialize3.renderForm;return _react.default.createElement(_reactNative.View,{key:key,style:[_Form.default.container,style,fieldset&&_Form.default.fieldset],__source:{fileName:_jsxFileName,lineNumber:82}},title&&_react.default.createElement(_Text.default,{headline:true,level:6,style:[_Form.default.title,_Form.default.anchor],__source:{fileName:_jsxFileName,lineNumber:84}},title),Object.keys(attributes).map(function(field){var props=attributes[field];var keyMap=key?key+"."+field:field;return props.attributes?renderForm({attributes:props.attributes,fieldset:true,key:keyMap,style:(0,_modules.buildStyle)({inline:inline,style:style},_Form.default),title:props.title,value:value[field]}):renderField({field:field,props:props,value:value[field],keyMap:keyMap});}));};_this.renderField=function(_ref3){var field=_ref3.field,_ref3$props=_ref3.props;_ref3$props=_ref3$props===void 0?{}:_ref3$props;var inline=_ref3$props.inline,required=_ref3$props.required,style=_ref3$props.style,type=_ref3$props.type,props=(0,_objectWithoutProperties2.default)(_ref3$props,["inline","required","style","type"]),_ref3$value=_ref3.value,value=_ref3$value===void 0?props.defaultValue:_ref3$value,keyMap=_ref3.keyMap;var _assertThisInitialize4=(0,_assertThisInitialized2.default)(_this),_onChange=_assertThisInitialize4._onChange,color=_assertThisInitialize4.props.color;var error;var invalid=required&&!props.disabled&&(!type&&value&&value.trim().length===0||!value);if(Object.keys(KEYBOARDS).includes(props.keyboard)){if(!KEYBOARDS[props.keyboard](value,props)){error='error';invalid=true;}}if(invalid)_this.state.valid=false;return(0,_react.createElement)(Inputs[type]||_Input.default,(0,_objectSpread2.default)({key:keyMap,label:props.label||field,color:color},props,{error:error||props.error,required:required&&(value===undefined||!type&&value.trim().length===0),value:value,onChange:function onChange(keyValue){return _onChange({keyValue:keyValue,keyMap:keyMap});},style:(0,_modules.buildStyle)({inline:inline,style:style},_Form.default)}));};return _this;}(0,_createClass2.default)(Form,[{key:"componentWillMount",value:function componentWillMount(){(0,_modules.consolidate)(this.props);}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){(0,_modules.consolidate)(nextProps);}},{key:"componentWillUpdate",value:function componentWillUpdate(){this.state.valid=true;}},{key:"componentDidUpdate",value:function componentDidUpdate(){var onValid=this.props.onValid,valid=this.state.valid;onValid(valid);}},{key:"render",value:function render(){var renderForm=this.renderForm,_this$props=this.props,attributes=_this$props.attributes,value=_this$props.value,title=_this$props.title,inherit=(0,_objectWithoutProperties2.default)(_this$props,["attributes","value","title"]);return _react.default.createElement(_reactNative.ScrollView,{style:inherit.style,__source:{fileName:_jsxFileName,lineNumber:151}},renderForm({attributes:attributes,value:value,title:title}));}}]);return Form;}(_react.PureComponent);Form.propTypes={attributes:(0,_propTypes.shape)({}),color:_propTypes.string,value:(0,_propTypes.shape)({}),onChange:_propTypes.func,onValid:_propTypes.func,title:_propTypes.string};Form.defaultProps={attributes:{},color:undefined,value:undefined,title:undefined,onChange:undefined,onValid:function onValid(){}};var _default=Form;exports.default=_default;