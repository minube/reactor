var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _entropy=_interopRequireWildcard(require("./entropy"));var _AsyncStore=_interopRequireDefault(require("./AsyncStore"));var _UUID=_interopRequireDefault(require("./UUID"));var _package=_interopRequireDefault(require("../../../package.json"));var STORE_FINGERPRINT=_package.default.name+":fingerprint";var _callee=function _callee(){var fingerprint,connectionEntropy,entropy,uuid;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regenerator.default.awrap(_AsyncStore.default.getItem(STORE_FINGERPRINT));case 2:fingerprint=_context.sent;if(typeof fingerprint==='string')fingerprint=undefined;if(fingerprint){_context.next=13;break;}_context.next=7;return _regenerator.default.awrap((0,_entropy.connection)());case 7:connectionEntropy=_context.sent;entropy=(0,_objectSpread2.default)({},_entropy.default,connectionEntropy,{random:Math.floor(Math.random()*Math.pow(2,32)),timestamp:new Date().getTime()});uuid=(0,_UUID.default)(Object.values(entropy).join('-'));fingerprint={uuid:uuid,device_id:(0,_UUID.default)(uuid)};_context.next=13;return _regenerator.default.awrap(_AsyncStore.default.setItem(STORE_FINGERPRINT,fingerprint));case 13:return _context.abrupt("return",fingerprint);case 14:case"end":return _context.stop();}}});};exports.default=_callee;